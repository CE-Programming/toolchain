	assume	adl=1

	section	.text

	public	__dtoll
	public	__dtoull

; __dtoll_c correctly handles all non-UB cases for both
; (long long)long double and (unsigned long long)long double
__dtoll:
__dtoull:
	; f64_ret_i64
	push	af, iy
	ld	a, b
	res	7, b	; fabsl(x)
	push	bc, de, hl
	ld	hl, 8
	add	hl, sp
	rlca
	ld	(hl), a	; store the sign of x in the padding byte
	call	__dtoll_c
	pop	af, af, af, iy, af
	ret

	extern	__dtoll_c
