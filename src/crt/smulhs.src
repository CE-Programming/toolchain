	.assume	adl=1

	.section	.text

	.global	__smulhs
	.type	__smulhs, @function

; HL = ((int32_t)HL * (int32_t)BC) >> 16
__smulhs:
	push	bc
	push	hl
	call	__smulhu

	; if (BC < 0) { result -= HL; }
	bit	7, b
	pop	bc
	jr	z, .L.positive_hl
	or	a, a
	sbc	hl, bc
.L.positive_hl:

	; if (HL < 0) { result -= BC; }
	bit	7, b
	pop	bc
	ret	z
	or	a, a
	sbc	hl, bc
	ret

	.extern	__smulhu
