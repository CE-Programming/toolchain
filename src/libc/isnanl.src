	.assume	adl=1

	.section	.text

	.global	__isnanl
	.type	__isnanl, @function

; bool _isnanl(long double)
__isnanl:
	pop	bc
	pop	hl
	pop	de
	or	a, a
	adc	hl, de
	pop	de
	push	bc
	push	bc
	push	bc
	push	bc
	ld	a, e
	jr	nz, .L.mant_nonzero	; normal, subnormal, or NaN
	jr	c, .L.mant_nonzero	; normal, subnormal, or NaN
	; common NaN, inf, normal, or subnormal
	or	a, a
	ret	z
	dec	a
.L.mant_nonzero:
	add	a, 16	; overflows 0xF0
	sbc	a, a
	ret	z
	ld	a, d
	add	a, a
	add	a, 2
	sbc	a, a
	ret
